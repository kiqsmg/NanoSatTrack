"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=require("lodash/omit"),e=require("lodash/isNumber"),o=require("lodash/filter"),i=require("@nivo/core"),a=require("@react-spring/web"),r=require("react/jsx-runtime");function s(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var u=s(n),l=s(e),d=s(o);function h(){return h=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},h.apply(this,arguments)}var c={dotSize:4,noteWidth:120,noteTextOffset:8,animate:!0,motionStiffness:90,motionDamping:13},x=function(n){var e=typeof n;return t.isValidElement(n)||"string"===e||"function"===e||"object"===e},f=function(t){var n=typeof t;return"string"===n||"function"===n},y=function(t){return"circle"===t.type},m=function(t){return"dot"===t.type},p=function(t){return"rect"===t.type},g=function(t){var n=t.data,e=t.annotations,o=t.getPosition,i=t.getDimensions;return e.reduce((function(t,e){var a=e.offset||0;return[].concat(t,d.default(n,e.match).map((function(t){var n=o(t),r=i(t);return(y(e)||p(e))&&(r.size=r.size+2*a,r.width=r.width+2*a,r.height=r.height+2*a),h({},u.default(e,["match","offset"]),n,r,{size:e.size||r.size,datum:t})})))}),[])},k=function(t,n,e,o){var a=Math.atan2(o-n,e-t);return i.absoluteAngleDegrees(i.radiansToDegrees(a))},v=function(t){var n,e,o=t.x,a=t.y,r=t.noteX,s=t.noteY,u=t.noteWidth,d=void 0===u?c.noteWidth:u,h=t.noteTextOffset,x=void 0===h?c.noteTextOffset:h;if(l.default(r))n=o+r;else{if(void 0===r.abs)throw new Error("noteX should be either a number or an object containing an 'abs' property");n=r.abs}if(l.default(s))e=a+s;else{if(void 0===s.abs)throw new Error("noteY should be either a number or an object containing an 'abs' property");e=s.abs}var f=o,m=a,g=k(o,a,n,e);if(y(t)){var v=i.positionFromAngle(i.degreesToRadians(g),t.size/2);f+=v.x,m+=v.y}if(p(t)){var W=Math.round((g+90)/45)%8;0===W&&(m-=t.height/2),1===W&&(f+=t.width/2,m-=t.height/2),2===W&&(f+=t.width/2),3===W&&(f+=t.width/2,m+=t.height/2),4===W&&(m+=t.height/2),5===W&&(f-=t.width/2,m+=t.height/2),6===W&&(f-=t.width/2),7===W&&(f-=t.width/2,m-=t.height/2)}var b=n,w=n;return(g+90)%360>180?(b-=d,w-=d):w+=d,{points:[[f,m],[n,e],[w,e]],text:[b,e-x],angle:g+90}},W=function(n){return t.useMemo((function(){return v(n)}),[n])},b=function(n){var e=n.datum,o=n.x,s=n.y,l=n.note,d=i.useTheme(),c=i.useMotionConfig(),x=c.animate,f=c.config,y=a.useSpring({x:o,y:s,config:f,immediate:!x});return"function"==typeof l?t.createElement(l,{x:o,y:s,datum:e}):r.jsxs(r.Fragment,{children:[d.annotations.text.outlineWidth>0&&r.jsx(a.animated.text,{x:y.x,y:y.y,style:h({},d.annotations.text,{strokeLinejoin:"round",strokeWidth:2*d.annotations.text.outlineWidth,stroke:d.annotations.text.outlineColor}),children:l}),r.jsx(a.animated.text,{x:y.x,y:y.y,style:u.default(d.annotations.text,["outlineWidth","outlineColor"]),children:l})]})},w=function(n){var e=n.points,o=n.isOutline,s=void 0!==o&&o,u=i.useTheme(),l=t.useMemo((function(){var t=e[0];return e.slice(1).reduce((function(t,n){return t+" L"+n[0]+","+n[1]}),"M"+t[0]+","+t[1])}),[e]),d=i.useAnimatedPath(l);if(s&&u.annotations.link.outlineWidth<=0)return null;var c=h({},u.annotations.link);return s&&(c.strokeLinecap="square",c.strokeWidth=u.annotations.link.strokeWidth+2*u.annotations.link.outlineWidth,c.stroke=u.annotations.link.outlineColor,c.opacity=u.annotations.link.outlineOpacity),r.jsx(a.animated.path,{fill:"none",d:d,style:c})},j=function(t){var n=t.x,e=t.y,o=t.size,s=i.useTheme(),u=i.useMotionConfig(),l=u.animate,d=u.config,c=a.useSpring({x:n,y:e,radius:o/2,config:d,immediate:!l});return r.jsxs(r.Fragment,{children:[s.annotations.outline.outlineWidth>0&&r.jsx(a.animated.circle,{cx:c.x,cy:c.y,r:c.radius,style:h({},s.annotations.outline,{fill:"none",strokeWidth:s.annotations.outline.strokeWidth+2*s.annotations.outline.outlineWidth,stroke:s.annotations.outline.outlineColor,opacity:s.annotations.outline.outlineOpacity})}),r.jsx(a.animated.circle,{cx:c.x,cy:c.y,r:c.radius,style:s.annotations.outline})]})},C=function(t){var n=t.x,e=t.y,o=t.size,s=void 0===o?c.dotSize:o,u=i.useTheme(),l=i.useMotionConfig(),d=l.animate,x=l.config,f=a.useSpring({x:n,y:e,radius:s/2,config:x,immediate:!d});return r.jsxs(r.Fragment,{children:[u.annotations.outline.outlineWidth>0&&r.jsx(a.animated.circle,{cx:f.x,cy:f.y,r:f.radius,style:h({},u.annotations.outline,{fill:"none",strokeWidth:2*u.annotations.outline.outlineWidth,stroke:u.annotations.outline.outlineColor,opacity:u.annotations.outline.outlineOpacity})}),r.jsx(a.animated.circle,{cx:f.x,cy:f.y,r:f.radius,style:u.annotations.symbol})]})},z=function(t){var n=t.x,e=t.y,o=t.width,s=t.height,u=t.borderRadius,l=void 0===u?6:u,d=i.useTheme(),c=i.useMotionConfig(),x=c.animate,f=c.config,y=a.useSpring({x:n-o/2,y:e-s/2,width:o,height:s,config:f,immediate:!x});return r.jsxs(r.Fragment,{children:[d.annotations.outline.outlineWidth>0&&r.jsx(a.animated.rect,{x:y.x,y:y.y,rx:l,ry:l,width:y.width,height:y.height,style:h({},d.annotations.outline,{fill:"none",strokeWidth:d.annotations.outline.strokeWidth+2*d.annotations.outline.outlineWidth,stroke:d.annotations.outline.outlineColor,opacity:d.annotations.outline.outlineOpacity})}),r.jsx(a.animated.rect,{x:y.x,y:y.y,rx:l,ry:l,width:y.width,height:y.height,style:d.annotations.outline})]})},P=function(t,n){n.forEach((function(n,e){var o=n[0],i=n[1];0===e?t.moveTo(o,i):t.lineTo(o,i)}))};exports.Annotation=function(t){var n=t.datum,e=t.x,o=t.y,i=t.note,a=W(t);if(!x(i))throw new Error("note should be a valid react element");return r.jsxs(r.Fragment,{children:[r.jsx(w,{points:a.points,isOutline:!0}),y(t)&&r.jsx(j,{x:e,y:o,size:t.size}),m(t)&&r.jsx(C,{x:e,y:o,size:t.size}),p(t)&&r.jsx(z,{x:e,y:o,width:t.width,height:t.height,borderRadius:t.borderRadius}),r.jsx(w,{points:a.points}),r.jsx(b,{datum:n,x:a.text[0],y:a.text[1],note:i})]})},exports.bindAnnotations=g,exports.computeAnnotation=v,exports.defaultProps=c,exports.getLinkAngle=k,exports.isCanvasNote=f,exports.isCircleAnnotation=y,exports.isDotAnnotation=m,exports.isRectAnnotation=p,exports.isSvgNote=x,exports.renderAnnotationsToCanvas=function(t,n){var e=n.annotations,o=n.theme;0!==e.length&&(t.save(),e.forEach((function(n){if(!f(n.note))throw new Error("note is invalid for canvas implementation");o.annotations.link.outlineWidth>0&&(t.lineCap="square",t.strokeStyle=o.annotations.link.outlineColor,t.lineWidth=o.annotations.link.strokeWidth+2*o.annotations.link.outlineWidth,t.beginPath(),P(t,n.computed.points),t.stroke(),t.lineCap="butt"),y(n)&&o.annotations.outline.outlineWidth>0&&(t.strokeStyle=o.annotations.outline.outlineColor,t.lineWidth=o.annotations.outline.strokeWidth+2*o.annotations.outline.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),m(n)&&o.annotations.symbol.outlineWidth>0&&(t.strokeStyle=o.annotations.symbol.outlineColor,t.lineWidth=2*o.annotations.symbol.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),p(n)&&o.annotations.outline.outlineWidth>0&&(t.strokeStyle=o.annotations.outline.outlineColor,t.lineWidth=o.annotations.outline.strokeWidth+2*o.annotations.outline.outlineWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),t.strokeStyle=o.annotations.link.stroke,t.lineWidth=o.annotations.link.strokeWidth,t.beginPath(),P(t,n.computed.points),t.stroke(),y(n)&&(t.strokeStyle=o.annotations.outline.stroke,t.lineWidth=o.annotations.outline.strokeWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),m(n)&&(t.fillStyle=o.annotations.symbol.fill,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.fill()),p(n)&&(t.strokeStyle=o.annotations.outline.stroke,t.lineWidth=o.annotations.outline.strokeWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),"function"==typeof n.note?n.note(t,{datum:n.datum,x:n.computed.text[0],y:n.computed.text[1],theme:o}):(t.font=o.annotations.text.fontSize+"px "+o.annotations.text.fontFamily,t.textAlign="left",t.textBaseline="alphabetic",t.fillStyle=o.annotations.text.fill,t.strokeStyle=o.annotations.text.outlineColor,t.lineWidth=2*o.annotations.text.outlineWidth,o.annotations.text.outlineWidth>0&&(t.lineJoin="round",t.strokeText(n.note,n.computed.text[0],n.computed.text[1]),t.lineJoin="miter"),t.fillText(n.note,n.computed.text[0],n.computed.text[1]))})),t.restore())},exports.useAnnotations=function(n){var e=n.data,o=n.annotations,i=n.getPosition,a=n.getDimensions;return t.useMemo((function(){return g({data:e,annotations:o,getPosition:i,getDimensions:a})}),[e,o,i,a])},exports.useComputedAnnotation=W,exports.useComputedAnnotations=function(n){var e=n.annotations;return t.useMemo((function(){return e.map((function(t){return h({},t,{computed:v(h({},t))})}))}),[e])};
//# sourceMappingURL=nivo-annotations.cjs.js.map
